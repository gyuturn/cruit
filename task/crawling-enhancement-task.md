# 크롤링 확장 및 중복 제거 기능 태스크

## 개요
크롤링 대상 사이트 확장, AI 재추천 시 중복 제거, UI 간소화

---

## 요구사항

### 1. 크롤링 대상 사이트 추가 (3개)
- 현재: 사람인, 잡코리아 (2개)
- 목표: 5개 사이트로 확장

### 2. AI 재추천 시 중복 제거
- 이전에 추천된 공고가 다시 나오지 않도록
- 중복 관리 데이터는 파일로 저장
- 중복 판별 키 선정이 핵심

### 3. 갱신 버튼 삭제
- "갱신하기" 버튼 제거
- "AI에게 학습후 재추천" 버튼만 유지

---

## 1. 크롤링 대상 사이트 분석

### 현재 크롤링 사이트
| 사이트 | URL | 특징 |
|--------|-----|------|
| 사람인 | saramin.co.kr | 국내 최대, 풍부한 데이터 |
| 잡코리아 | jobkorea.co.kr | 대기업 공고 多 |

### 추가 후보 사이트 분석

#### 후보 1: 원티드 (Wanted)
| 항목 | 내용 |
|------|------|
| URL | https://www.wanted.co.kr |
| 특징 | IT/스타트업 특화, 연봉 공개 |
| 장점 | 기술스택 명시, 회사 문화 정보 |
| 단점 | API 기반 (SSR), 크롤링 난이도 높음 |
| 검색 URL | `https://www.wanted.co.kr/wdlist/518?country=kr&job_sort=job.latest_order&years=-1&locations=all` |
| 파싱 난이도 | 중 (JSON API 사용 가능) |

#### 후보 2: 프로그래머스 (Programmers)
| 항목 | 내용 |
|------|------|
| URL | https://career.programmers.co.kr |
| 특징 | 개발자 전문 채용 플랫폼 |
| 장점 | 기술 테스트 연계, 개발자 친화적 |
| 단점 | 공고 수 상대적으로 적음 |
| 검색 URL | `https://career.programmers.co.kr/job` |
| 파싱 난이도 | 중 |

#### 후보 3: 로켓펀치 (RocketPunch)
| 항목 | 내용 |
|------|------|
| URL | https://www.rocketpunch.com |
| 특징 | 스타트업 특화 |
| 장점 | 회사 정보 상세, 투자 정보 |
| 단점 | 대기업 공고 적음 |
| 검색 URL | `https://www.rocketpunch.com/jobs` |
| 파싱 난이도 | 중 |

#### 후보 4: 인크루트 (Incruit)
| 항목 | 내용 |
|------|------|
| URL | https://www.incruit.com |
| 특징 | 종합 채용 포털 |
| 장점 | 사람인/잡코리아와 유사, 파싱 용이 |
| 단점 | UI 복잡 |
| 검색 URL | `https://search.incruit.com/list/search.asp` |
| 파싱 난이도 | 하 |

#### 후보 5: 점핏 (Jumpit)
| 항목 | 내용 |
|------|------|
| URL | https://www.jumpit.co.kr |
| 특징 | 개발자 전문 (사람인 계열) |
| 장점 | 기술스택 필터 우수, 연봉 정보 |
| 단점 | React 기반 SSR |
| 검색 URL | `https://www.jumpit.co.kr/positions` |
| 파싱 난이도 | 중 |

### 추천 조합 (3개 추가)

| 우선순위 | 사이트 | 선정 이유 |
|---------|--------|----------|
| 1 | **원티드** | IT/스타트업 특화, 연봉 공개, 사용자 가치 높음 |
| 2 | **점핏** | 개발자 전문, 기술스택 정보 풍부 |
| 3 | **인크루트** | 종합 포털, 파싱 용이, 공고 수 多 |

**대안:** 프로그래머스 (개발자 전문), 로켓펀치 (스타트업)

---

## 2. 중복 제거 기능 설계

### 2.1 중복 판별 키 분석

#### 옵션 A: 공고 URL 기반
```
키: jobPosting.url
예: "https://www.saramin.co.kr/zf_user/jobs/relay/view?rec_idx=12345"
```
| 장점 | 단점 |
|------|------|
| 고유성 보장 | URL 변경 시 중복 인식 실패 |
| 구현 단순 | 같은 공고가 다른 사이트에 있으면 중복 처리 안됨 |

#### 옵션 B: 회사명 + 공고제목 조합
```
키: `${company}_${title}`.toLowerCase().replace(/\s/g, '')
예: "삼성전자_백엔드개발자신입"
```
| 장점 | 단점 |
|------|------|
| 다른 사이트 동일 공고 감지 | 제목 약간 다르면 중복 인식 실패 |
| URL 변경에 강함 | 같은 회사 유사 공고 구분 어려움 |

#### 옵션 C: 회사명 + 제목 + 위치 조합 (권장)
```
키: `${company}_${title}_${location}`.toLowerCase().replace(/\s/g, '')
예: "삼성전자_백엔드개발자_수원시"
```
| 장점 | 단점 |
|------|------|
| 중복 정확도 높음 | 키 길이 증가 |
| 지역별 다른 공고 구분 가능 | 위치 표기 불일치 가능 |

#### 옵션 D: 해시 기반
```
키: MD5/SHA256(`${company}_${title}_${location}`)
예: "a1b2c3d4e5f6..."
```
| 장점 | 단점 |
|------|------|
| 일정한 키 길이 | 디버깅 어려움 |
| 저장 공간 효율적 | 해시 충돌 가능성 (극히 낮음) |

### 2.2 권장 키 전략

**Primary Key:** 회사명 + 제목 (정규화)
```typescript
function generateJobKey(job: JobPosting): string {
  const normalized = `${job.company}_${job.title}`
    .toLowerCase()
    .replace(/\s+/g, '')      // 공백 제거
    .replace(/[^가-힣a-z0-9]/g, ''); // 특수문자 제거
  return normalized;
}
```

**보조 키 (선택):** URL (같은 사이트 내 중복 방지)

### 2.3 저장 파일 구조

#### 저장 위치
```
/data/seen_jobs.json
```

#### 파일 형식
```json
{
  "version": 1,
  "lastUpdated": "2026-01-31T12:00:00Z",
  "userId": "user-profile-id",
  "seenJobs": {
    "삼성전자_백엔드개발자": {
      "firstSeen": "2026-01-30T10:00:00Z",
      "lastSeen": "2026-01-31T12:00:00Z",
      "count": 3,
      "sources": ["saramin", "jobkorea"],
      "urls": [
        "https://saramin.co.kr/...",
        "https://jobkorea.co.kr/..."
      ]
    },
    "네이버_프론트엔드개발자": {
      "firstSeen": "2026-01-31T12:00:00Z",
      "lastSeen": "2026-01-31T12:00:00Z",
      "count": 1,
      "sources": ["wanted"],
      "urls": ["https://wanted.co.kr/..."]
    }
  },
  "stats": {
    "totalSeen": 150,
    "totalFiltered": 45
  }
}
```

#### 간소화 버전 (권장)
```json
{
  "seenKeys": [
    "삼성전자_백엔드개발자",
    "네이버_프론트엔드개발자",
    "카카오_ios개발자"
  ],
  "lastUpdated": "2026-01-31T12:00:00Z"
}
```

### 2.4 중복 제거 로직 흐름

```
1. 크롤링 완료
   ↓
2. 각 공고에 대해 키 생성
   ↓
3. seen_jobs.json 로드
   ↓
4. 키가 seenKeys에 있는지 확인
   ↓
   ├─ 있음 → 필터링 (추천 목록에서 제외)
   └─ 없음 → 추천 목록에 포함
   ↓
5. 추천된 공고들의 키를 seenKeys에 추가
   ↓
6. seen_jobs.json 저장
```

### 2.5 중복 초기화 정책

| 정책 | 설명 |
|------|------|
| 수동 초기화 | 사용자가 "기록 초기화" 버튼 클릭 |
| 기간 기반 | 30일 이상 된 기록 자동 삭제 |
| 개수 기반 | 최대 1000개 유지, 초과 시 오래된 것 삭제 |

---

## 3. 갱신 버튼 삭제 설계

### 3.1 현재 버튼 구조
```
[🧠 AI에게 학습후 재추천] [갱신하기]
```

### 3.2 변경 후 버튼 구조
```
[🧠 AI에게 학습후 재추천]
```

### 3.3 영향 분석

| 항목 | 영향 |
|------|------|
| `JobList.tsx` | `onRefresh` prop 제거, 갱신 버튼 UI 삭제 |
| `page.tsx` | `handleRefresh` 함수 제거 |
| 사용자 경험 | AI 학습 버튼으로 통합 (단순화) |

### 3.4 기능 통합 방안

기존 "갱신하기"의 역할:
- 새로운 공고 크롤링
- AI 추천 재실행

→ "AI에게 학습후 재추천" 버튼에서 동일하게 수행
→ 피드백 없이 "건너뛰기" 선택 시 = 기존 갱신과 동일

---

## 4. 구현 파일 목록

### 신규 생성
| 파일 | 설명 |
|------|------|
| `/src/lib/crawler/wanted.ts` | 원티드 크롤러 |
| `/src/lib/crawler/jumpit.ts` | 점핏 크롤러 |
| `/src/lib/crawler/incruit.ts` | 인크루트 크롤러 |
| `/src/lib/dedup/index.ts` | 중복 제거 모듈 |
| `/data/seen_jobs.json` | 조회 이력 저장 파일 |

### 수정
| 파일 | 변경 내용 |
|------|----------|
| `/src/lib/crawler/index.ts` | 새 크롤러 통합, 중복 제거 적용 |
| `/src/components/JobList.tsx` | 갱신 버튼 제거 |
| `/src/app/page.tsx` | handleRefresh 제거 |
| `/src/app/api/recommendations/route.ts` | 중복 제거 로직 적용 |

---

## 5. 데이터 흐름도

```
┌─────────────────────────────────────────────────────────────┐
│                    AI 학습후 재추천 클릭                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   5개 사이트 크롤링                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │ 사람인  │ │잡코리아 │ │ 원티드  │ │  점핏   │ │인크루트 ││
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘│
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    중복 제거 (Dedup)                         │
│  1. 각 공고 키 생성: company_title                           │
│  2. seen_jobs.json 로드                                     │
│  3. 이미 본 공고 필터링                                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    AI 추천 (with 피드백)                     │
│  - 사용자 프로필                                             │
│  - 별점 데이터                                               │
│  - 사용자 피드백 (선호/비선호)                                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    추천 결과 반환                            │
│  - 새로운 공고만 포함                                        │
│  - 추천된 공고 키를 seen_jobs.json에 저장                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 고려사항

### 6.1 크롤링 관련
- **Rate Limiting**: 각 사이트별 요청 간격 조절 (1-2초)
- **User-Agent**: 사이트별 적절한 헤더 설정
- **에러 처리**: 일부 사이트 실패해도 다른 사이트 결과 반환
- **병렬 처리**: Promise.allSettled로 동시 크롤링

### 6.2 중복 제거 관련
- **파일 동시 접근**: 락 메커니즘 또는 atomic write
- **파일 크기 관리**: 주기적 정리 (1000개 초과 시)
- **초기화 옵션**: 사용자가 기록 초기화 가능하도록

### 6.3 성능 관련
- **크롤링 시간**: 5개 사이트 → 병렬 처리로 최적화
- **중복 체크**: Set 자료구조로 O(1) 조회

---

## 7. 예상 일정

| 단계 | 작업 | 예상 규모 |
|------|------|----------|
| 1 | 원티드 크롤러 구현 | 중 |
| 2 | 점핏 크롤러 구현 | 중 |
| 3 | 인크루트 크롤러 구현 | 하 |
| 4 | 크롤러 통합 및 병렬 처리 | 하 |
| 5 | 중복 제거 모듈 구현 | 중 |
| 6 | 갱신 버튼 삭제 | 하 |
| 7 | 테스트 및 검증 | 중 |

---

*작성일: 2026-01-31*
*상태: 구현 완료*

---

## 8. 구현 완료 내역

### 신규 생성 파일
| 파일 | 설명 |
|------|------|
| `/src/lib/crawler/wanted.ts` | 원티드 크롤러 (API 기반) |
| `/src/lib/crawler/jumpit.ts` | 점핏 크롤러 (API 기반) |
| `/src/lib/crawler/incruit.ts` | 인크루트 크롤러 (HTML 파싱) |
| `/src/lib/dedup/index.ts` | 중복 제거 모듈 |
| `/data/seen_jobs.json` | 조회 이력 저장 파일 |

### 수정 파일
| 파일 | 변경 내용 |
|------|----------|
| `/src/lib/crawler/index.ts` | 5개 크롤러 통합, 병렬 처리, 중복 제거 적용 |
| `/src/components/JobList.tsx` | 갱신 버튼 제거, onRefresh prop 제거 |
| `/src/app/page.tsx` | handleRefresh 함수 제거 |
| `/.gitignore` | data/seen_jobs.json 제외 추가 |

### 중복 제거 키
```typescript
// 회사명 + 제목 정규화
key = `${company}_${title}`.toLowerCase().replace(/\s+/g, '').replace(/[^가-힣a-z0-9_]/g, '')
```
